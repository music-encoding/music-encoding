<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  © 2018 by the Music Encoding Initiative (MEI).
  Licensed under the Educational Community License, Version 2.0 (the "License"); you may
  not use this file except in compliance with the License. You may obtain a copy of the License
  at http://opensource.org/licenses/ECL-2.0.
  
  Unless required by applicable law or agreed to in writing, software distributed under the
  License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS
  OF ANY KIND, either express or implied. See the License for the specific language
  governing permissions and limitations under the License.
  
  This is a derivative work based on earlier versions of the schema © 2001-2006 Perry Roland
  and the Rector and Visitors of the University of Virginia; licensed under the Educational
  Community License version 1.0.
  
  CONTACT: info@music-encoding.org
-->
<?xml-model href="http://www.tei-c.org/release/xml/tei/custom/schema/relaxng/tei_odds.rng" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-model href="http://www.tei-c.org/release/xml/tei/custom/schema/relaxng/tei_odds.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0" xmlns:rng="http://relaxng.org/ns/structure/1.0"
  xmlns:sch="http://purl.oclc.org/dsdl/schematron">
  <teiHeader>
    <fileDesc>
      <titleStmt>
        <title>Music Encoding Initiative Guidelines: <title type="sub">Mensural
          Customization</title></title>
        <respStmt>
          <resp>Authored by</resp>
          <name xml:id="PR">Perry Roland</name>
        </respStmt>
      </titleStmt>
      <publicationStmt>
        <p/>
      </publicationStmt>
      <sourceDesc>
        <p/>
      </sourceDesc>
    </fileDesc>
  </teiHeader>
  <text>
    <front>
      <divGen type="toc"/>
    </front>
    <body>

      <!-- Limit the set of possible start elements -->
      <schemaSpec ident="mei" ns="http://www.music-encoding.org/ns/mei" prefix="mei_"
        start="mei meiHead meiCorpus music">

        <!-- Declare MEI and XLink namespaces for use in Schematron -->
        <constraintSpec ident="set_ns" scheme="isoschematron" mode="add">
          <constraint>
            <sch:ns xmlns:sch="http://purl.oclc.org/dsdl/schematron" prefix="mei"
              uri="http://www.music-encoding.org/ns/mei"/>
            <sch:ns xmlns:sch="http://purl.oclc.org/dsdl/schematron" prefix="xlink"
              uri="http://www.w3.org/1999/xlink"/>
          </constraint>
        </constraintSpec>

        <!-- Include all modules -->
        <!-- Deactivate the CMN, cmnOrnaments, and neumes modules -->
        <moduleRef key="MEI"/>
        <moduleRef key="MEI.analytical"/>
        <!--<moduleRef key="MEI.cmn"/>-->
        <!--<moduleRef key="MEI.cmnOrnaments"/>-->
        <moduleRef key="MEI.corpus"/>
        <moduleRef key="MEI.critapp"/>
        <moduleRef key="MEI.drama"/>
        <moduleRef key="MEI.edittrans"/>
        <moduleRef key="MEI.externalsymbols"/>
        <moduleRef key="MEI.facsimile"/>
        <moduleRef key="MEI.figtable"/>
        <moduleRef key="MEI.fingering"/>
        <moduleRef key="MEI.frbr"/>
        <moduleRef key="MEI.genetic"/>
        <moduleRef key="MEI.gestural"/>
        <moduleRef key="MEI.harmony"/>
        <moduleRef key="MEI.header"/>
        <moduleRef key="MEI.lyrics"/>
        <moduleRef key="MEI.mensural"/>
        <moduleRef key="MEI.midi"/>
        <moduleRef key="MEI.msDesc"/>
        <moduleRef key="MEI.namesdates"/>
        <!--<moduleRef key="MEI.neumes"/>-->
        <moduleRef key="MEI.performance"/>
        <moduleRef key="MEI.ptrref"/>
        <moduleRef key="MEI.shared"/>
        <moduleRef key="MEI.stringtab"/>
        <moduleRef key="MEI.text"/>
        <moduleRef key="MEI.usersymbols"/>
        <moduleRef key="MEI.visual"/>

        <!-- Include SVG -->
        <moduleRef url="https://www.tei-c.org/release/xml/tei/custom/schema/relaxng/svg11.rng"
          prefix="svg_">
          <content>
            <rng:define name="mei_model.graphicLike" combine="choice">
              <rng:ref name="svg_svg"/>
            </rng:define>
          </content>
        </moduleRef>

        <!-- Disable CMN-specific model classes in the shared module -->
        <classSpec ident="model.sectionPart.cmn" module="MEI.shared" type="model" mode="delete"/>
        <classSpec ident="model.layerPart.cmn" module="MEI.shared" type="model" mode="delete"/>

        <macroSpec ident="data.DURATION.mensural" module="MEI.mensural" type="dt" mode="change">
          <desc>Logical, that is, written, note-shape (or note symbol) attribute values for the mensural repertoire.</desc>
          <content>
            <valList type="closed">
              <valItem ident="maxima">
                <desc>Two or three times as long as a longa.</desc>
              </valItem>
              <valItem ident="longa">
                <desc>Two or three times as long as a brevis.</desc>
              </valItem>
              <valItem ident="brevis">
                <desc>Two or three times as long as a semibrevis.</desc>
              </valItem>
              <valItem ident="semibrevis">
                <desc>Half or one-third as long as a breve/brevis.</desc>
              </valItem>
              <valItem ident="minima">
                <desc>Half or one-third as long as a semibreve/semibrevis.</desc>
              </valItem>
              <valItem ident="semiminima">
                <desc>Half as long as a minima.</desc>
              </valItem>
              <valItem ident="fusa">
                <desc>Half as long as a semiminima.</desc>
              </valItem>
              <valItem ident="semifusa">
                <desc>Half as long as a fusa.</desc>
              </valItem>
              <valItem ident="2B" mode="add">
                <desc>Two-breve rest.</desc>
              </valItem>
              <valItem ident="3B" mode="add">
                <desc>Three-breve rest.</desc>
              </valItem>
            </valList>
          </content>
        </macroSpec>
        
        <constraintSpec ident="multibreve_rests_only" scheme="isoschematron" mode="add">
          <constraint>
            <sch:rule context="mei:note">
              <sch:assert test="not(@dur='2B' or @dur='3B')">Values 2B and 3B are to be used only with rest elements.</sch:assert>
            </sch:rule>
          </constraint>
        </constraintSpec>
        
        <macroSpec ident="data.DURQUALITY.mensural" module="MEI.mensural" type="dt" mode="add">
          <desc>Duration attribute values of a given note symbol for the mensural repertoire.</desc>
          <content>
            <valList type="closed">
              <valItem ident="perfecta">
                <desc>Three times the duration of the note in the next smaller degree.</desc>
              </valItem>
              <valItem ident="imperfecta">
                <desc>Two times the duration of the note in the next smaller degree.</desc>
              </valItem>
              <valItem ident="altera">
                <desc>Twice the original duration of the note (only usable in perfect mensurations).</desc>
              </valItem>
              <valItem ident="minor">
                <desc>Category of a regular semibrevis in Ars antiqua, equivalent to a third of a brevis.</desc>
              </valItem>
              <valItem ident="maior">
                <desc>Category of an altered semibrevis in Ars antiqua, equivalent to two minor semibrevis.</desc>
              </valItem>
              <valItem ident="duplex">
                <desc>One of the three categories of a longa in Ars antiqua ('duplex', 'perfecta', and 'imperfecta'). A duplex longa is twice as long as a regular longa.</desc>
              </valItem>
            </valList>
          </content>
        </macroSpec>
        
        <classSpec ident="att.duration.quality" module="MEI.mensural" type="atts" mode="add">
          <desc>Attribute that expresses duration for a given mensural note symbol.</desc>
          <attList>
            <attDef ident="dur.quality" usage="rec" mode="add">
              <desc>Encodes the durational quality of a mensural note using the values provided by the data.DURQUALITY.mensural datatype (i.e., the perfect / imperfect / altered / major / minor / duplex quality of a note).</desc>
              <datatype>
                <rng:ref name="data.DURQUALITY.mensural"/>
              </datatype>
            </attDef>
          </attList>
        </classSpec>
        
        <classSpec ident="att.note.log" module="MEI.shared" type="atts" mode="change">
          <desc>Logical domain attributes.</desc>
          <classes mode="replace">
            <memberOf key="att.augmentDots"/>
            <memberOf key="att.coloration"/>
            <memberOf key="att.cue"/>
            <memberOf key="att.duration.logical"/>
            <memberOf key="att.event"/>
            <memberOf key="att.note.log.cmn"/>
            <memberOf key="att.note.log.mensural"/>
            <memberOf key="att.pitched"/>
            <memberOf key="att.duration.quality" mode="add"/>
          </classes>
        </classSpec>
                
        <macroSpec ident="data.STEMFORM.mensural" module="MEI.mensural" type="dt" mode="add">
          <desc>Form of the stem attached to the note.</desc>
          <content>
            <valList type="closed">
              <valItem ident="circle">
                <desc>Stem has a circular form.</desc>
              </valItem>
              <valItem ident="oblique">
                <desc>Stem has an oblique form.</desc>
              </valItem>
              <valItem ident="swallowtail">
                <desc>Stem has a swallowtail form.</desc>
              </valItem>
              <valItem ident="virgula">
                <desc>Stem has a virgula-like form.</desc>
              </valItem>
            </valList>
          </content>
        </macroSpec>
        <macroSpec ident="data.FLAGPOS.mensural" module="MEI.mensural" type="dt" mode="add">
          <desc>Position of the flag relative to the stem.</desc>
          <content>
            <valList type="closed">
              <valItem ident="left">
                <desc>Flag lies at the left side of the stem.</desc>
              </valItem>
              <valItem ident="right">
                <desc>Flag lies at the right side of the stem.</desc>
              </valItem>
              <valItem ident="center">
                <desc>Flag is centered in the stem.</desc>
              </valItem>
            </valList>
          </content>
        </macroSpec>
        <macroSpec ident="data.FLAGFORM.mensural" module="MEI.mensural" type="dt" mode="add">
          <desc>Form of the flag.</desc>
          <content>
            <valList type="closed">
              <valItem ident="straight">
                <desc>Flag is a straight horizontal line.</desc>
              </valItem>
              <valItem ident="angled">
                <desc>Flag is a straight line at an angle.</desc>
              </valItem>
              <valItem ident="curled">
                <desc>Flag is curled.</desc>
              </valItem>
              <valItem ident="flared">
                <desc>Flag is flared.</desc>
              </valItem>
              <valItem ident="extended">
                <desc>Flag looks extended.</desc>
              </valItem>
              <valItem ident="hooked">
                <desc>Flag is hooked-form.</desc>
              </valItem>
            </valList>
          </content>
            <remarks>
                <p>
                    <!-- TODO: Add samples for all values here  -->
                    <!--<graphic url="ExampleImages/accid-20100510.png" height="50%" width="50%"/>-->
                </p>
            </remarks>
        </macroSpec>
        
        <classSpec ident="att.STEMPROPERTIES.mensural" module="MEI.mensural" type="atts" mode="add">
          <desc>Attributes that describe the properties of stems in the mensural repertoire.</desc>
            <classes>
                <memberOf key="att.xy"/>
            </classes>
            <attList>
            <attDef ident="pos" usage="opt">
              <desc>Records the position of the stem in relation to the note head(s).</desc>
              <datatype>
                <rng:ref name="data.STEMPOSITION"/>
              </datatype>
            </attDef>
            <attDef ident="length" usage="opt">
              <desc>Encodes the stem length.</desc>
              <datatype>
                <rng:ref name="data.MEASUREMENTABS"/>
              </datatype>
            </attDef>
            <attDef ident="form" usage="opt">
              <desc>Encodes the form of the stem using the values provided by the data.STEMFORM.mensural datatype.</desc>
              <datatype>
                <rng:ref name="data.STEMFORM.mensural"/>
              </datatype>
            </attDef>
            <attDef ident="dir" usage="opt">
              <desc>Describes the direction of a stem.</desc>
              <datatype>
                <rng:ref name="data.STEMDIRECTION"/>
              </datatype>
            </attDef>
            <attDef ident="flag.pos" usage="opt">
              <desc>Records the position of the flag using the values provided by the data.FLAGPOS.mensural datatype.</desc>
              <datatype>
                <rng:ref name="data.FLAGPOS.mensural"/>
              </datatype>
            </attDef>
            <attDef ident="flag.form" usage="opt">
              <desc>Encodes the form of the flag using the values provided by the data.FLAGFORM.mensural datatype.</desc>
              <datatype>
                <rng:ref name="data.FLAGFORM.mensural"/>
              </datatype>
            </attDef>
          </attList>
        </classSpec>
        
        <elementSpec ident="stem" module="MEI.mensural" mode="add">
          <desc>A stem element.</desc>
          <classes>
            <memberOf key="att.common"/>
            <memberOf key="att.STEMPROPERTIES.mensural"/>
            <memberOf key="model.noteModifierLike"/>
          </classes>
          <content>
            <rng:empty/>
          </content>
          <constraintSpec ident="Check_stem" scheme="isoschematron">
            <constraint>
              <sch:rule context="mei:stem">
                <sch:assert test="not(ancestor::mei:note/@*[starts-with(local-name(),'stem.')])">A note with nested stem elements must not have @stem.* attributes.</sch:assert>
              </sch:rule>
            </constraint>
          </constraintSpec>
          <remarks>
            <p>Mensural notes can have multiple stems and these may have various forms, directions, and types of flags.
              Multiple stem elements can be encoded as children of a single note. The attributes <att>pos</att>,
              <att>length</att>, <att>form</att>, and <att>dir</att> allow to encode different positions, lengths,
              forms, and directions for each these stems. The attributes <att>flag.pos</att> and <att>flag.form</att> 
              also allow to encode different types of flags for each of the stems.</p>
          </remarks>
        </elementSpec>
        
        <classSpec ident="att.stems" module="MEI.shared" type="atts" mode="replace">
          <desc>Attributes that describe the properties of stemmed features; that is, chords and notes.</desc>
          <classes>
            <memberOf key="att.stems.cmn"/>
            <memberOf key="att.stems.mensural"/>
          </classes>
          <attList org="group">
            <attDef ident="stem.dir" usage="opt">
              <desc>Describes the direction of a stem.</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:ref name="data.STEMDIRECTION" />
              </datatype>
            </attDef>
            <attDef ident="stem.len" usage="opt">
              <desc>Encodes the stem length.</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:ref name="data.MEASUREMENTABS" />
              </datatype>
            </attDef>
            <attDef ident="stem.mod" usage="opt">
              <desc>Encodes any stem "modifiers"; that is, symbols rendered on the stem, such as tremolo or Sprechstimme indicators.</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:ref name="data.STEMMODIFIER" />
              </datatype>
            </attDef>
            <attDef ident="stem.pos" usage="opt">
              <desc>Records the position of the stem in relation to the note head(s).</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:ref name="data.STEMPOSITION" />
              </datatype>
            </attDef>
            <attDef ident="stem.visible" usage="opt">
              <desc>Determines whether a stem should be displayed.</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:ref name="data.BOOLEAN" />
              </datatype>
            </attDef>
            <attDef ident="stem.x" usage="opt">
              <desc>Records the output x coordinate of the stem's attachment point.</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:data type="decimal"/>
              </datatype>
            </attDef>
            <attDef ident="stem.y" usage="opt">
              <desc>Records the output y coordinate of the stem's attachment point.</desc>
              <datatype maxOccurs="1" minOccurs="1">
                <rng:data type="decimal"/>
              </datatype>
            </attDef>
          </attList>
        </classSpec>
          
          <classSpec ident="att.stems.mensural" module="MEI.mensural" type="atts">
              <desc>Attributes that describe the properties of stemmed features specific to mensural repertoires.</desc>
              <attList>
                  <attDef ident="stem.form" usage="opt" mode="add">
                      <desc>Records the form of the stem.</desc>
                      <datatype maxOccurs="1" minOccurs="1">
                          <rng:ref name="data.STEMFORM.mensural"/>
                      </datatype>
                  </attDef>
              </attList>
          </classSpec>

      </schemaSpec>
    </body>
  </text>
</TEI>
